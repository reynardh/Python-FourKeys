# delete any orphaned resources created by a Four Keys deployment

steps:  
  - name: gcr.io/$PROJECT_ID/fourkeys-builder
    entrypoint: /bin/bash
    args:
      - '-c'
      - |
        ### Delete Terraform state
        gsutil -m rm -r gs://$_TARGET_PROJECT-tf-state/terraform || true

        ### Delete all resources
        ./experimental/project_cleaner.sh --project_id=$_TARGET_PROJECT || true

        echo "Turning off APIs"
        gcloud services disable compute.googleapis.com --force
        gcloud services disable run.googleapis.com --force
        gcloud services disable bigquery.googleapis.com --force 
        gcloud services disable secretmanager.googleapis.com --force
substitutions:
  _TARGET_PROJECT: fourkeys-tf-tests